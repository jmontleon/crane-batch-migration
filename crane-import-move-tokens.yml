- name: Find tokens
  find:
    path: "{{ playbook_dir }}/output/{{ item }}"
    recurse: true
    patterns: 'Secret.*token.*yaml'
    use_regex: true
  register: tokens

- name: Ensure token dir exists
  file:
    state: directory
    path: "{{ playbook_dir }}/output/{{ item }}-tokens"

- name: Move tokens
  shell: mv "{{ token.path }}" "{{ playbook_dir }}/output/{{ item }}-tokens"
  with_items: "{{ tokens.files }}"
  loop_control:
    loop_var: "token"
    label: "{{ token.path }}"

- name: Find dockercfgs
  find:
    path: "{{ playbook_dir }}/output/{{ item }}"
    recurse: true
    patterns: 'Secret.*dockercfg.*yaml'
    use_regex: true
  register: dockercfgs

- name: Move dockercfgs
  shell: mv "{{ dockercfg.path }}" "{{ playbook_dir }}/output/{{ item }}-tokens"
  with_items: "{{ dockercfgs.files }}"
  loop_control:
    loop_var: "dockercfg"
    label: "{{ dockercfg.path }}"
