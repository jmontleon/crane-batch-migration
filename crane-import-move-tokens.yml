- name: Find tokens
  find:
    path: "{{ playbook_dir }}/output/{{ item }}"
    recurse: true
    patterns: 'Secret.*token.*yaml'
    use_regex: true
  register: tokens

- name: Ensure token dir exists
  file:
    state: directory
    path: "{{ playbook_dir }}/output/{{ item }}-tokens"

- name: Move tokens
  shell: mv "{{ token.path }}" "{{ playbook_dir }}/output/{{ item }}-tokens"
  with_items: "{{ tokens.files }}"
  loop_control:
    loop_var: "token"
